<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Giorgio elettricista e antennista</title>

<!-- Colore barra / app -->
<meta name="theme-color" content="#0A2E5C">

<!-- Favicon (puoi lasciare questa o metterne una tua in data URL) -->
<link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/w8AAusB9QqP9x8AAAAASUVORK5CYII=">

<style>
  :root{--brand:#0A2E5C;--accent:#F7931E}
  body{margin:0;font:15px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Arial;color:#0a223d;background:#f6f8fb}
  header{background:var(--brand);color:#fff;padding:14px 16px}
  h1{margin:0;font-size:18px}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}
  .note{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:14px}
  .ok{display:inline-block;background:var(--accent);color:#fff;padding:6px 10px;border-radius:10px;margin-top:10px}
  .muted{color:#64748b}
</style>
</head>
<body>

<header>
  <h1>Giorgio ‚Äî Elettricista &amp; Antennista</h1>
  <div class="muted">PWA installabile ¬∑ offline ¬∑ stampa</div>
</header>

<div class="wrap">
  <div class="note">
    <strong>‚öôÔ∏è File unico, PWA auto-configurata</strong><br>
    Questo <em>index.html</em> crea da solo <b>manifest</b> e <b>service worker</b>. Puoi gi√† attivare GitHub Pages e installare l‚Äôapp.<br><br>
    <b>Per usare il tuo gestionale:</b> incolla il tuo HTML completo nel blocco qui sotto (sostituisci il segnaposto).
    <div class="ok">Funziona anche offline</div>
  </div>

  <!-- APP: QUI IL TUO GESTIONALE  -->
  <div id="app" class="wrap" style="padding:24px 0">
    <!-- üîΩ Sostituisci tutto questo div con il TUO gestionale (Preventivi/Interventi ecc.) -->
    <p class="muted">Segnaposto app ‚Äî incolla qui il tuo gestionale per intero (HTML+CSS+JS in linea o con link esterni).</p>
  </div>
  <!-- /APP -->
</div>

<script>
/* =========================
   1) ICONS in Data URL
   Sostituisci ICON192/ICON512 con il TUO logo (JPG/PNG) in base64.
   Basta mettere:  const ICON192 = "data:image/jpeg;base64,.....";
   ========================= */
const ICON192 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAYAAABb2j/AAAAAAXNSR0IArs4c6QAAABxpRE9UAAAAAgAAAAAAAAAwAAAAKAAAADAAAABMAf5j2AAAAF0lEQVR42u3BMQEAAADCIPunNsYQAAAAAAAAAO4GQwAAAHf2k1wAAAAASUVORK5CYII=";
const ICON512 = ICON192; // puoi metterne uno migliore 512√ó512

/* =========================
   2) Manifest generato al volo (un solo file!)
   ========================= */
const manifest = {
  name: "Giorgio elettricista e antennista",
  short_name: "Gestionale Giorgio",
  description: "Preventivi & Interventi ‚Äî PWA offline.",
  start_url: "./",
  scope: "./",
  display: "standalone",
  theme_color: "#0A2E5C",
  background_color: "#0A2E5C",
  icons: [
    { src: ICON192, sizes: "192x192", type: ICON192.split(';')[0].split(':')[1] || "image/png" },
    { src: ICON512, sizes: "512x512", type: ICON512.split(';')[0].split(':')[1] || "image/png" }
  ]
};

// Crea <link rel="manifest"> con Blob (niente file esterni)
(function injectManifest(){
  const blob = new Blob([JSON.stringify(manifest)], {type: 'application/manifest+json'});
  const url  = URL.createObjectURL(blob);
  const link = document.createElement('link');
  link.rel = 'manifest';
  link.href = url;
  document.head.appendChild(link);
})();

/* =========================
   3) Service Worker iniettato da stringa (offline ready)
   Strategia: network-first con fallback alla cache + caching dinamico.
   ========================= */
const swCode = `
  const CACHE = 'ggiorgio-v1';
  self.addEventListener('install', e => {
    e.waitUntil((async ()=>{
      const c = await caches.open(CACHE);
      try { await c.addAll(['./']); } catch(e){}
      self.skipWaiting();
    })());
  });
  self.addEventListener('activate', e => {
    e.waitUntil((async ()=>{
      const keys = await caches.keys();
      await Promise.all(keys.filter(k => k!==CACHE).map(k=>caches.delete(k)));
      self.clients.claim();
    })());
  });
  self.addEventListener('fetch', e => {
    const req = e.request;
    // ignoriamo chiamate di terze parti non GET
    if (req.method !== 'GET') { return; }
    e.respondWith((async ()=>{
      try {
        const net = await fetch(req);
        const cache = await caches.open(CACHE);
        cache.put(req, net.clone());
        return net;
      } catch(err) {
        const hit = await caches.match(req);
        return hit || caches.match('./');
      }
    })());
  });
`;

// Registra SW da Blob (nessun file esterno)
(function registerSW(){
  if (!('serviceWorker' in navigator)) return;
  const blob = new Blob([swCode], {type: 'text/javascript'});
  const swUrl = URL.createObjectURL(blob);
  window.addEventListener('load', () => navigator.serviceWorker.register(swUrl).catch(()=>{}));
})();
</script>

</body>
</html>
